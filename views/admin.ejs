<%- include('partials/header', { title: 'Admin Dashboard' }) %>

<div class="flex min-h-screen bg-gray-100">
  <!-- Sidebar -->
  <div class="w-64 bg-gray-900 text-white p-6 shadow-lg">
    <div class="mb-8">
      <h2 class="text-2xl font-bold text-emerald-400">Pixelcart Admin</h2>
    </div>
    
    <nav class="space-y-2">
      <a href="/admin" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-emerald-400 bg-gray-700 text-emerald-400">
        <i class="fas fa-tachometer-alt mr-3"></i>Dashboard
      </a>
      <a href="/admin/products" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-emerald-400">
        <i class="fas fa-box mr-3"></i>Products
      </a>
      <a href="/admin/orders" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-emerald-400">
        <i class="fas fa-shopping-cart mr-3"></i>Orders
      </a>
      <a href="/admin/customers" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-emerald-400">
        <i class="fas fa-users mr-3"></i>Customers
      </a>
      <a href="/admin/settings" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-gray-700 hover:text-emerald-400">
        <i class="fas fa-cog mr-3"></i>Settings
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="flex-1 p-8">
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-4">Admin Dashboard</h1>
      <div class="flex space-x-4">
        <button class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 flex items-center space-x-2" onclick="showAddProductModal()">
          <i class="fas fa-plus"></i>
          <span>Add Product</span>
        </button>
        <button class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300 flex items-center space-x-2" onclick="refreshData()">
          <i class="fas fa-sync"></i>
          <span>Refresh</span>
        </button>
      </div>
    </div>

    <% if (locals.message) { %>
      <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6 flex items-center">
        <i class="fas fa-check-circle mr-2"></i>
        <%= message %>
      </div>
    <% } %>

    <!-- Dashboard Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="bg-white p-6 rounded-lg shadow-md">
        <div class="flex items-center">
          <div class="p-3 rounded-full bg-emerald-100 text-emerald-600 mr-4">
            <i class="fas fa-shopping-bag text-xl"></i>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-600">Total Products</p>
            <p class="text-2xl font-bold text-gray-900"><%= stats?.totalProducts || 0 %></p>
          </div>
        </div>
      </div>
      
      <div class="bg-white p-6 rounded-lg shadow-md">
        <div class="flex items-center">
          <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
            <i class="fas fa-users text-xl"></i>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-600">Total Users</p>
            <p class="text-2xl font-bold text-gray-900"><%= stats?.totalUsers || 0 %></p>
          </div>
        </div>
      </div>
      
      <div class="bg-white p-6 rounded-lg shadow-md">
        <div class="flex items-center">
          <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
            <i class="fas fa-shopping-cart text-xl"></i>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-600">Total Orders</p>
            <p class="text-2xl font-bold text-gray-900"><%= stats?.totalOrders || 0 %></p>
          </div>
        </div>
      </div>
      
      <div class="bg-white p-6 rounded-lg shadow-md">
        <div class="flex items-center">
          <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
            <i class="fas fa-dollar-sign text-xl"></i>
          </div>
          <div>
            <p class="text-sm font-medium text-gray-600">Total Revenue</p>
            <p class="text-2xl font-bold text-gray-900">$<%= stats?.totalRevenue?.toFixed(2) || '0.00' %></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Tabs -->
    <div class="flex space-x-1 mb-6 bg-gray-200 p-1 rounded-lg">
      <button class="tab-btn active px-4 py-2 rounded-md font-medium transition-colors duration-200 bg-white text-emerald-600 shadow-sm" data-tab="products">Products</button>
      <button class="tab-btn px-4 py-2 rounded-md font-medium transition-colors duration-200 text-gray-600 hover:text-gray-900" data-tab="orders">Orders</button>
      <button class="tab-btn px-4 py-2 rounded-md font-medium transition-colors duration-200 text-gray-600 hover:text-gray-900" data-tab="users">Users</button>
      <button class="tab-btn px-4 py-2 rounded-md font-medium transition-colors duration-200 text-gray-600 hover:text-gray-900" data-tab="analytics">Analytics</button>
    </div>

    <!-- Products Tab -->
    <div class="admin-tab-content active" id="products">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Product Management</h2>
        <div class="relative">
          <input type="text" id="product-search" placeholder="Search products..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500">
          <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
      </div>
    
      <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Image</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Brand</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rating</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% if (products && products.length > 0) { %>
              <% products.forEach(product => { %>
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap">
                    <img src="<%= product.image %>" alt="<%= product.name %>" class="h-12 w-12 rounded-lg object-cover">
                  </td>
                  <td class="px-6 py-4">
                    <div>
                      <div class="text-sm font-medium text-gray-900"><%= product.name %></div>
                      <div class="text-sm text-gray-500 truncate max-w-xs"><%= product.description %></div>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= product.brand %></td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-emerald-100 text-emerald-800">
                      <%= product.category %>
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">$<%= product.price.toFixed(2) %></div>
                    <% if (product.originalPrice && product.originalPrice > product.price) { %>
                      <div class="text-sm text-gray-500 line-through">$<%= product.originalPrice.toFixed(2) %></div>
                    <% } %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <span class="text-sm font-medium text-gray-900"><%= product.rating.toFixed(1) %></span>
                      <span class="text-yellow-400 ml-1">‚≠ê</span>
                      <span class="text-sm text-gray-500 ml-1">(<%= product.numRatings %>)</span>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <div class="flex space-x-2">
                      <button class="text-blue-600 hover:text-blue-900" onclick="editProduct('<%= product._id %>')">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="text-red-600 hover:text-red-900" onclick="deleteProduct('<%= product._id %>')">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr>
                <td colspan="7" class="px-6 py-12 text-center text-gray-500">No products found</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
  </div>

  <!-- Orders Tab -->
  <div class="admin-tab-content" id="orders">
    <div class="tab-header">
      <h2>Order Management</h2>
      <div class="filter-controls">
        <select id="order-status-filter">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="processing">Processing</option>
          <option value="shipped">Shipped</option>
          <option value="delivered">Delivered</option>
          <option value="cancelled">Cancelled</option>
        </select>
      </div>
    </div>
    
    <div class="orders-table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Order #</th>
            <th>Customer</th>
            <th>Items</th>
            <th>Total</th>
            <th>Status</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (orders && orders.length > 0) { %>
            <% orders.forEach(order => { %>
              <tr>
                <td><%= order.orderNumber %></td>
                <td>
                  <div class="customer-info">
                    <h4><%= order.user.firstName %> <%= order.user.lastName %></h4>
                    <p><%= order.user.email %></p>
                  </div>
                </td>
                <td><%= order.items.length %> items</td>
                <td>$<%= order.total.toFixed(2) %></td>
                <td>
                  <span class="status-badge status-<%= order.status %>">
                    <%= order.status.charAt(0).toUpperCase() + order.status.slice(1) %>
                  </span>
                </td>
                <td><%= new Date(order.createdAt).toLocaleDateString() %></td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-view" onclick="viewOrder('<%= order._id %>')">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-edit" onclick="updateOrderStatus('<%= order._id %>')">
                      <i class="fas fa-edit"></i>
                    </button>
                  </div>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="7" class="no-data">No orders found</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Users Tab -->
  <div class="admin-tab-content" id="users">
    <div class="tab-header">
      <h2>User Management</h2>
      <div class="search-bar">
        <input type="text" id="user-search" placeholder="Search users...">
        <i class="fas fa-search"></i>
      </div>
    </div>
    
    <div class="users-table-container">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Orders</th>
            <th>Joined</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (users && users.length > 0) { %>
            <% users.forEach(user => { %>
              <tr>
                <td>
                  <div class="user-info">
                    <h4><%= user.firstName || 'N/A' %> <%= user.lastName || '' %></h4>
                  </div>
                </td>
                <td><%= user.email %></td>
                <td><%= user.phone || 'N/A' %></td>
                <td><%= user.orders?.length || 0 %></td>
                <td><%= new Date(user.createdAt).toLocaleDateString() %></td>
                <td>
                  <div class="action-buttons">
                    <button class="btn-view" onclick="viewUser('<%= user._id %>')">
                      <i class="fas fa-eye"></i>
                    </button>
                  </div>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="6" class="no-data">No users found</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Analytics Tab -->
  <div class="admin-tab-content" id="analytics">
    <div class="tab-header">
      <h2>Analytics & Reports</h2>
    </div>
    
    <div class="analytics-grid">
      <div class="chart-container">
        <h3>Sales Overview</h3>
        <div class="chart-placeholder">
          <i class="fas fa-chart-line"></i>
          <p>Sales chart would be displayed here</p>
        </div>
      </div>
      
      <div class="chart-container">
        <h3>Top Products</h3>
        <div class="top-products">
          <% if (topProducts && topProducts.length > 0) { %>
            <% topProducts.forEach((product, index) => { %>
              <div class="top-product-item">
                <span class="rank">#<%= index + 1 %></span>
                <img src="<%= product.image %>" alt="<%= product.name %>">
                <div class="product-details">
                  <h4><%= product.name %></h4>
                  <p>$<%= product.price.toFixed(2) %></p>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <p>No data available</p>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</main>

    <!-- Add Product Modal -->
    <div class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden" id="addProductModal">
      <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-2xl font-bold text-gray-800">Add New Product</h2>
          <button class="text-gray-400 hover:text-gray-600" onclick="closeAddProductModal()">
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>
        
        <form action="/admin/add-product" method="POST" class="space-y-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Product Name *</label>
              <input type="text" id="name" name="name" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500">
            </div>
            <div>
              <label for="brand" class="block text-sm font-medium text-gray-700 mb-1">Brand *</label>
              <input type="text" id="brand" name="brand" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500">
            </div>
          </div>
          
          <div>
            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description *</label>
            <textarea id="description" name="description" rows="3" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500"></textarea>
          </div>

          <div>
            <label for="image" class="block text-sm font-medium text-gray-700 mb-1">Image URL *</label>
            <input type="url" id="image" name="image" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500">
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="price" class="block text-sm font-medium text-gray-700 mb-1">Price *</label>
              <input type="number" id="price" name="price" step="0.01" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500">
            </div>
            <div>
              <label for="originalPrice" class="block text-sm font-medium text-gray-700 mb-1">Original Price</label>
              <input type="number" id="originalPrice" name="originalPrice" step="0.01" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500">
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
              <select id="category" name="category" required class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500">
                <option value="">Select Category</option>
                <option value="apparel">Apparel</option>
                <option value="accessories">Accessories</option>
                <option value="footwear">Footwear</option>
                <option value="electronics">Electronics</option>
                <option value="home">Home & Garden</option>
              </select>
            </div>
            <div>
              <label for="rating" class="block text-sm font-medium text-gray-700 mb-1">Rating</label>
              <input type="number" id="rating" name="rating" step="0.1" min="0" max="5" value="4.5" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500">
            </div>
          </div>

          <div>
            <label for="numRatings" class="block text-sm font-medium text-gray-700 mb-1">Number of Ratings</label>
            <input type="number" id="numRatings" name="numRatings" value="0" class="w-full p-3 border border-gray-300 rounded-md focus:ring-emerald-500 focus:border-emerald-500">
          </div>

          <div class="flex justify-end space-x-4 pt-4">
            <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300" onclick="closeAddProductModal()">Cancel</button>
            <button type="submit" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300">Add Product</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<%- include('partials/footer') %>

<script>
// Tab functionality
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const tabName = this.dataset.tab;
    
    // Remove active class from all tabs and buttons
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.admin-tab-content').forEach(t => t.classList.remove('active'));
    
    // Add active class to clicked button and corresponding content
    this.classList.add('active');
    document.getElementById(tabName).classList.add('active');
  });
});

// Modal functionality
function showAddProductModal() {
  document.getElementById('addProductModal').style.display = 'flex';
}

function closeAddProductModal() {
  document.getElementById('addProductModal').style.display = 'none';
}

// Close modal when clicking outside
window.addEventListener('click', function(event) {
  const modal = document.getElementById('addProductModal');
  if (event.target === modal) {
    closeAddProductModal();
  }
});

// Product search
document.getElementById('product-search').addEventListener('input', function() {
  const searchTerm = this.value.toLowerCase();
  const rows = document.querySelectorAll('#products tbody tr');
  
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(searchTerm) ? '' : 'none';
  });
});

// User search
document.getElementById('user-search').addEventListener('input', function() {
  const searchTerm = this.value.toLowerCase();
  const rows = document.querySelectorAll('#users tbody tr');
  
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(searchTerm) ? '' : 'none';
  });
});

// Order status filter
document.getElementById('order-status-filter').addEventListener('change', function() {
  const status = this.value;
  const rows = document.querySelectorAll('#orders tbody tr');
  
  rows.forEach(row => {
    if (!status || row.querySelector('.status-badge').textContent.toLowerCase().includes(status)) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
});

// Action functions
function editProduct(productId) {
  // Implement edit product functionality
  alert('Edit product: ' + productId);
}

function deleteProduct(productId) {
  if (confirm('Are you sure you want to delete this product?')) {
    // Implement delete product functionality
    alert('Delete product: ' + productId);
  }
}

function viewOrder(orderId) {
  // Implement view order functionality
  alert('View order: ' + orderId);
}

function updateOrderStatus(orderId) {
  // Implement update order status functionality
  alert('Update order status: ' + orderId);
}

function viewUser(userId) {
  // Implement view user functionality
  alert('View user: ' + userId);
}

function refreshData() {
  location.reload();
}
</script>
