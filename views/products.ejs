<%- include('partials/header', { title: 'Products' }) %>
<%- include('partials/navbar') %>

<main class="container">
  <h1 class="page-title">All Products</h1>

  <form action="/products" method="GET" class="filter-bar" id="filter-form">
    <div class="filter-group">
      <label for="category">Filter by Category:</label>
      <select name="category" id="category" class="filter-select">
        <option value="">All Categories</option>
        <% categories.forEach(cat => { %>
          <option value="<%= cat %>" <%= (locals.currentCategory === cat) ? 'selected' : '' %>>
            <%= cat.charAt(0).toUpperCase() + cat.slice(1) %>
          </option>
        <% }) %>
      </select>
    </div>

    <div class="filter-group">
      <label for="sort">Sort by:</label>
      <select name="sort" id="sort" class="filter-select">
        <option value="default" <%= (locals.currentSort === 'default') ? 'selected' : '' %>>Newest</option>
        <option value="price-low-high" <%= (locals.currentSort === 'price-low-high') ? 'selected' : '' %>>Price: Low to High</option>
        <option value="price-high-low" <%= (locals.currentSort === 'price-high-low') ? 'selected' : '' %>>Price: High to Low</option>
        <option value="rating" <%= (locals.currentSort === 'rating') ? 'selected' : '' %>>Rating: High to Low</option>
      </select>
    </div>
  </form>
  <div class="product-grid">
    <% if (products.length > 0) { %>
      <% products.forEach(product => { %>
        <div class="product-card">
          <div class="product-image">
            <img src="<%= product.image %>" alt="<%= product.name %>">
          </div>
          <div class="product-info">
            <span class="product-category"><%= product.category %></span>
            <h3 class="product-name"><%= product.name %></h3>
            <div class="product-rating">Rating: <%= product.rating %> ★</div>
            <div class="product-price">$<%= product.price.toFixed(2) %></div>
          </div>
          <div class="product-actions">
            
            <button 
              class="btn-wishlist <%= user.wishlist.includes(product._id) ? 'active' : '' %>" 
              data-id="<%= product._id %>"
            >
              ♥
            </button>
            
            <a 
              href="https://instagram.com/YourBrandInstagram" 
              target="_blank" 
              class="btn-buy"
            >
              Buy Now
            </a>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p style="text-align: center; font-size: 1.1rem; grid-column: 1 / -1;">
        No products found matching your criteria.
      </p>
    <% } %>
  </div>
</main>

<%- include('partials/footer') %>
